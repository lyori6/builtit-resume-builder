import React, { useState } from 'react';
import { Download, Mail, Phone, MapPin, Globe, Linkedin } from 'lucide-react';

const PDFResumeGenerator = () => {
  const [resumeData] = useState({
    "basics": {
      "name": "Lyor (Leo) Itzhaki",
      "headline": "Product Lead & Founder | Building AI-Powered MVPs & Fintech Solutions",
      "email": "lyori6@gmail.com",
      "phone": "(408) 217-3383",
      "location": "Redwood City, CA",
      "url": {
        "label": "lyori.com ",
        "href": "https://www.lyori.com "
      },
      "customFields": [
        {
          "id": "fcdvenj06hjzfwzh68nnntnb",
          "icon": "linkedin-logo",
          "name": "linkedin.com/in/lyor/",
          "value": "https://www.linkedin.com/in/lyor/"
        }
      ]
    },
    "sections": {
      "summary": {
        "content": "Full-stack product leader shipping AI-powered fintech & e-commerce experiences impacting 30M+ users. At TrueML, delivered ~$3-5M in annualized revenue uplift by increasing checkout conversion by 33% and payment completions by 19% across platforms serving millions; drove 24% merchant adoption and +30-pt NPS jump for EcoCart's new post-purchase line, and now demonstrates rapid MVP development (idea to production-ready full-stack apps in days) through Builtit.dev"
      },
      "experience": {
        "items": [
          {
            "company": "BuildIt.dev",
            "position": "Product Lead & Founder",
            "location": "Redwood City, CA",
            "date": "Dec 2024 – Present",
            "summary": "Founded an early-stage micro-agency, delivering AI-powered, production-ready MVPs with integrated automation for non-technical founders.\n• Spearheaded market validation via 25+ founder discovery calls, defining core service offerings focused on AI-driven solutions for regulated niches.\n• Developed a rapid delivery playbook leveraging reusable components and AI automation patterns to accelerate functional MVP builds from weeks to days.",
            "url": {
              "label": "builtit.dev",
              "href": "https://builtit.dev"
            }
          },
          {
            "company": "EcoCart",
            "position": "Product Manager",
            "location": "San Francisco, CA",
            "date": "Feb 2024 – Dec 2024",
            "summary": "Drove new product direction and prototyped package protection at a post-purchase eCom startup. Launched a revenue-share GTM to increase merchant adoption.\n• Established package protection as the next company revenue pillar by leading comprehensive discovery (market, partner, 10+ merchant interviews, data analysis) and MVP definition, including blueprinting and prototype development with engineering & design.\n• Launched a Shopify revenue-share pilot to improve merchant retention and alignment, securing 24% adoption from targeted merchants in the first month and lifting average NPS from 35 to 65.\n• Prototyped an LLM-driven claims triage system, demonstrating a potential 40% reduction in manual review and enabling early CS workflow testing"
          },
          {
            "company": "TrueML",
            "position": "Product Manager",
            "location": "San Francisco, CA",
            "date": "Jan 2022 – Nov 2023",
            "summary": "Owned the core payment product for a consumer debt platform. Conducted A/B tests, optimized user flows, and led MFA implementation to increase conversion and payment completion while ensuring compliance.\n• Led cross-functional optimization of the repayment platform (Eng, Data Science, Design, CS), delivering ~$3-5M annualized revenue uplift by scaling A/B testing to 30+ tests/qtr, lifting checkout CVR by 33% and payment completions by 19%.\n• Partnered with Data Science to refine ML-driven user segmentation by integrating richer behavioral data, boosting plan selection rates by 12% and overall user engagement by 34%.\n• Led a mobile-first redesign of the core repayment flow, simplifying UX and reducing average checkout time by 15 seconds, contributing to a 19% lift in completed payments."
          },
          {
            "company": "TrueML",
            "position": "Product Operations Manager, D2C",
            "location": "San Francisco, CA",
            "date": "Jun 2020 – Jan 2022",
            "summary": "Set up product ops & support org from scratch at a pre-PM fintech startup. Built SLAs, Looker performance dashboards, and aligned roadmaps across cross-functional teams.\n• Established the D2C customer support function, implementing foundational processes, SLAs, and dashboards that reduced average first response time from >24 hours to <4 hours while maintaining a 4.6/5 CSAT.\n• Developed and executed targeted HubSpot email and Twilio SMS campaigns based on user segmentation, driving a 25% increase in Monthly Active Users (MAU).\n• Spearheaded the specification and launch of BI dashboards (Looker) providing real-time visibility into support KPIs, leading to a 12% reduction in agent handle time and informing executive decision-making."
          },
          {
            "company": "Early-stage Startups (Consultant)",
            "position": "Product Manager",
            "location": "Palo Alto, CA",
            "date": "Aug 2019 – Sep 2020",
            "summary": "Founding PM partnering directly with founders on 0->1 products. Led discovery, scoping, and delivery from concept to launch.\n\nProgForce: Designed and rapidly prototyped an internal gamified platform for quarterly travel forecasting; UX-tested mechanics that drove participation 40% → 70% in prototype testing.\n\nAssemblyDrop: Scoped and defined the MVP for an on-demand contractor marketplace, then piloted the platform, enrolling 5 pilot crews and onboarding 1,000+ SKUs."
          }
        ]
      },
      "projects": {
        "items": [
          {
            "name": "DebtCat (Founder/Builder)",
            "description": "Independently developed and launched an AI-powered consumer debt rights platform (Next.js, OpenAI API, Stripe, PostGrid) featuring an educational chatbot and automated dispute letter generation. Demonstrates end-to-end product creation for a real user need.",
            "date": "2023 – Present",
            "url": {
              "label": "debtcat.com",
              "href": "https://debtcat.com"
            }
          },
          {
            "name": "FindMe.pet (Founder/Builder)",
            "description": "Launched an AI pet adoption matching platform (Next.js, Petfinder API, OpenAI API) designed to reduce shelter return rates by analyzing lifestyle compatibility. Showcases AI application to solve a passion-driven problem.",
            "date": "2024 – Present",
            "url": {
              "label": "findme.pet",
              "href": "https://FindMe.pet"
            }
          }
        ]
      },
      "skills": {
        "items": [
          {
            "name": "Product",
            "keywords": [
              "Product Strategy",
              "Roadmapping",
              "A/B Testing",
              "Stakeholder Management",
              "AI Product Strategy",
              "LLM Workflow Design",
              "User Research",
              "Agile Methodologies",
              "Market Analysis",
              "Go-to-Market Strategy"
            ]
          },
          {
            "name": "Technical",
            "keywords": [
              "SQL",
              "Next.js",
              "React",
              "JavaScript",
              "Serverless (Cloudflare Workers, Vercel Functions)",
              "Firebase",
              "Supabase",
              "API Integration (Stripe, OpenAI, Petfinder)"
            ]
          },
          {
            "name": "Tools",
            "keywords": [
              "Mixpanel",
              "Google Analytics",
              "Looker",
              "HubSpot",
              "Jira",
              "Cursor AI",
              "Windsurf",
              "GA4",
              "ClickUp"
            ]
          }
        ]
      },
      "education": {
        "items": [
          {
            "institution": "Shenkar College of Engineering",
            "studyType": "B.Sc., Industrial Engineering & Management",
            "date": "2017"
          }
        ]
      }
    }
  });

  const formatBulletPoints = (text) => {
    return text.split('\n').map((line, index) => {
      if (line.trim().startsWith('•')) {
        return (
          <li key={index} className="ml-4">
            {line.trim().substring(1).trim()}
          </li>
        );
      } else if (line.trim()) {
        return (
          <p key={index} className="mb-2 text-gray-700">
            {line.trim()}
          </p>
        );
      }
      return null;
    });
  };

  const generatePDF = () => {
    // Create a new window for printing to ensure it works in all environments
    const printWindow = window.open('', '_blank');
    const content = document.querySelector('.resume-content').innerHTML;
    
    printWindow.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Resume - ${resumeData.basics.name}</title>
          <script src="https://cdn.tailwindcss.com"></script>
          <style>
            @media print {
              body { -webkit-print-color-adjust: exact; color-adjust: exact; }
              @page { margin: 0.5in; size: letter; }
              .no-print { display: none !important; }
            }
            body { font-family: system-ui, -apple-system, sans-serif; }
          </style>
        </head>
        <body class="bg-white">
          ${content}
        </body>
      </html>
    `);
    
    printWindow.document.close();
    printWindow.focus();
    
    // Small delay to ensure content is loaded
    setTimeout(() => {
      printWindow.print();
      printWindow.close();
    }, 250);
  };

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Print button - hidden when printing */}
      <div className="print:hidden p-4 bg-white shadow-sm border-b">
        <div className="max-w-4xl mx-auto flex justify-between items-center">
          <h1 className="text-xl font-bold text-gray-900">Resume Generator</h1>
          <button
            onClick={generatePDF}
            className="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
          >
            <Download size={16} />
            Download PDF
          </button>
        </div>
      </div>

      {/* Resume content */}
      <div className="max-w-4xl mx-auto bg-white shadow-lg print:shadow-none print:max-w-none resume-content">
        {/* Header */}
        <div className="px-8 py-8 border-b border-gray-200 bg-gradient-to-r from-slate-50 to-white">
          <h1 className="text-4xl font-bold text-gray-900 mb-3 tracking-tight">
            {resumeData.basics.name}
          </h1>
          <p className="text-xl text-gray-700 mb-6 font-medium leading-relaxed">
            {resumeData.basics.headline}
          </p>
          
          {/* Contact Info */}
          <div className="flex flex-wrap gap-6 text-sm text-gray-600">
            <div className="flex items-center gap-2">
              <Mail size={16} className="text-blue-600" />
              <a href={`mailto:${resumeData.basics.email}`} className="hover:text-blue-600 transition-colors">
                {resumeData.basics.email}
              </a>
            </div>
            <div className="flex items-center gap-2">
              <Phone size={16} className="text-blue-600" />
              <span>{resumeData.basics.phone}</span>
            </div>
            <div className="flex items-center gap-2">
              <MapPin size={16} className="text-blue-600" />
              <span>{resumeData.basics.location}</span>
            </div>
            <div className="flex items-center gap-2">
              <Globe size={16} className="text-blue-600" />
              <a href={resumeData.basics.url.href} className="hover:text-blue-600 transition-colors">
                {resumeData.basics.url.label.trim()}
              </a>
            </div>
            <div className="flex items-center gap-2">
              <Linkedin size={16} className="text-blue-600" />
              <a href={resumeData.basics.customFields[0].value} className="hover:text-blue-600 transition-colors">
                {resumeData.basics.customFields[0].name}
              </a>
            </div>
          </div>
        </div>

        <div className="px-8 py-6 space-y-6">
          {/* Professional Summary */}
          <section>
            <h2 className="text-xl font-bold text-gray-900 mb-4 pb-2 border-b-2 border-blue-600 uppercase tracking-wide">
              Professional Summary
            </h2>
            <div className="bg-gray-50 p-6 rounded-xl shadow-sm">
              <p className="text-gray-700 leading-relaxed text-base">
                {resumeData.sections.summary.content}
              </p>
            </div>
          </section>

          {/* Professional Experience */}
          <section>
            <h2 className="text-xl font-bold text-gray-900 mb-4 pb-2 border-b-2 border-blue-600 uppercase tracking-wide">
              Professional Experience
            </h2>
            <div className="space-y-6">
              {resumeData.sections.experience.items.map((exp, index) => (
                <div key={index} className="bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow">
                  <div className="flex justify-between items-start mb-3">
                    <div className="flex-1">
                      <h3 className="text-lg font-bold text-gray-900 mb-1">
                        {exp.position}
                      </h3>
                      <p className="text-blue-600 font-semibold flex items-center gap-2">
                        {exp.company}
                        {exp.url && (
                          <a href={exp.url.href} className="text-sm text-blue-500 hover:underline transition-colors">
                            ({exp.url.label})
                          </a>
                        )}
                      </p>
                    </div>
                    <div className="text-right text-sm text-gray-500 ml-4">
                      <p className="font-medium whitespace-nowrap">{exp.date}</p>
                      <p className="whitespace-nowrap">{exp.location}</p>
                    </div>
                  </div>
                  <div className="text-sm text-gray-700">
                    <ul className="list-disc list-outside ml-5 space-y-2">
                      {formatBulletPoints(exp.summary)}
                    </ul>
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* Recent Projects */}
          <section>
            <h2 className="text-xl font-bold text-gray-900 mb-4 pb-2 border-b-2 border-blue-600 uppercase tracking-wide">
              Recent Projects
            </h2>
            <div className="space-y-4">
              {resumeData.sections.projects.items.map((project, index) => (
                <div key={index} className="bg-gray-50 p-6 rounded-xl shadow-sm">
                  <div className="flex justify-between items-start mb-3">
                    <h3 className="text-lg font-bold text-gray-900 flex-1">
                      {project.name}
                    </h3>
                    <div className="text-right text-sm ml-4">
                      <p className="text-gray-500 font-medium whitespace-nowrap">{project.date}</p>
                      {project.url && (
                        <a href={project.url.href} className="text-blue-600 hover:underline transition-colors whitespace-nowrap">
                          {project.url.label}
                        </a>
                      )}
                    </div>
                  </div>
                  <p className="text-gray-700 text-sm leading-relaxed">
                    {project.description}
                  </p>
                </div>
              ))}
            </div>
          </section>

          {/* Skills */}
          <section>
            <h2 className="text-xl font-bold text-gray-900 mb-4 pb-2 border-b-2 border-blue-600 uppercase tracking-wide">
              Core Competencies
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {resumeData.sections.skills.items.map((skillCategory, index) => (
                <div key={index} className="bg-gray-50 p-6 rounded-xl shadow-sm">
                  <h4 className="font-bold text-gray-900 mb-4 text-sm uppercase tracking-wide">
                    {skillCategory.name}
                  </h4>
                  <div className="flex flex-wrap gap-2">
                    {skillCategory.keywords.map((skill, skillIndex) => (
                      <span
                        key={skillIndex}
                        className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium hover:bg-blue-200 transition-colors"
                      >
                        {skill}
                      </span>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* Education */}
          <section>
            <h2 className="text-xl font-bold text-gray-900 mb-4 pb-2 border-b-2 border-blue-600 uppercase tracking-wide">
              Education
            </h2>
            <div className="bg-gray-50 p-6 rounded-xl shadow-sm">
              {resumeData.sections.education.items.map((edu, index) => (
                <div key={index} className="flex justify-between items-center">
                  <div>
                    <h3 className="font-bold text-gray-900 text-base">{edu.institution}</h3>
                    <p className="text-gray-700">{edu.studyType}</p>
                  </div>
                  <p className="text-gray-500 font-medium">{edu.date}</p>
                </div>
              ))}
            </div>
          </section>
        </div>
      </div>

      <style jsx>{`
        @media print {
          body {
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
          }
          
          .print\\:shadow-none {
            box-shadow: none !important;
          }
          
          .print\\:max-w-none {
            max-width: none !important;
          }
          
          .print\\:hidden {
            display: none !important;
          }
          
          @page {
            margin: 0.5in;
            size: letter;
          }
        }
      `}</style>
    </div>
  );
};

export default PDFResumeGenerator;